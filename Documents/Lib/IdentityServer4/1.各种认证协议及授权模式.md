# Http各种认证协议及授权模式

## 本文目录

* [全文目录](#1)
  * [Http Basic Auth基础认证](#2)
    * [认证流程](#2.1)
    * [对应报文](#2.1)
  * [Digest Auth摘要认证](#3)
    * [摘要盘问](#3.1)
  * [Session认证](#4)
  * [Cookie认证](#5)
  * [SSO单点登陆](#6)
  * [OAuth认证](#7)
  * [基于第三方的OpenId Connect认证](#8)
  * [Token&JWT认证](#9)
  * Reference
  * About Me

<span id="1"></span>

> 本节内容为一些基础的网络认证协议
>
> 阅读本节内容需要花费大约35分钟

## 全文目录

[（博客园）.NET Core Guide](https://www.cnblogs.com/WarrenRyan/p/12367312.html)

[（博客园）计算机科学/计算机网络/网络认证协议（超详细更新版，内含所有协议，暂未上线）](https://www.cnblogs.com/WarrenRyan/p/14097965.html)

[（Github）.NET Core Guide](https://github.com/StevenEco/.NetCoreGuide)

[（Github）ComputerScience（计算机科学版本，内容不一致，更偏向理论）](https://github.com/StevenEco/ComputerScience)

<span id="2"></span>

## Http Basic Auth 基础认证

Http Basic Auth，顾名思义，是最基础的一种协议，程序在请求时提供用户名和口令形式的身份凭证的一种登录验证方式，也是浏览器自己内置支持的功能。我们在很多路由器后台登录的界面都见过这个界面，输入用户名和密码后进入管理系统的

在进行基本认证的过程里，请求的HTTP头字段会包含Authorization字段，形式如下： Authorization: Basic <凭证>，该凭证是用户和密码的组和的base64编码。

最初，基本认证是定义在HTTP 1.0规范（RFC 1945）中，后续的有关安全的信息可以在HTTP 1.1规范（RFC 2616）和HTTP认证规范（RFC 2617）中找到。于1999年 RFC 2617 过期，于2015年的 RFC 7617 重新被定义。

这种认证方式已经几乎不会在互联网中找到了，因为安全性非常低。例如当你使用http协议时，如果没有使用SSL/TLS这样的传输层安全的协议，那么以明文传输的密钥和口令很容易被拦截。同时该方案也同样没有对服务器返回的信息提供保护。而且也没有提供一种登出注销的手段，现存的浏览器保存认证信息直到标签页或浏览器被关闭，或者用户清除历史记录。HTTP没有为服务器提供一种方法指示客户端丢弃这些被缓存的密钥。这意味着服务器端在用户不关闭浏览器的情况下，并没有一种有效的方法来让用户注销。在安全性上，我们的用户名密钥是直接通过base64加密发送，也很容易被黑客用彩虹表等手段进行破解。加密的格式为： *base64(username:password)*

这种请求方式并不要求用户和认证系统一定要有交互行为，用户可以获取自己的base64编码后在第一次访问时就添加认证消息头。因此对于服务器而言，这个认证手段是不代表用户的。举个例子：阿里巴巴走到大门前，大喊一声芝麻开门，门就开了。对于门而言，站在外面的是谁不重要，只需要口号对了即可，同时如果边上有着第三者存在（中间人），密码口令也非常容易被他知道。

<span id="2.1"></span>

### 认证流程

1. 浏览器向服务器发送请求，由于未携带请求头，故服务器响应一个401，同时返回应用域。

2. 接到应答后，客户端显示该认证域（通常是所访问的计算机或系统的描述）给用户并提示输入用户名和口令。此时用户可以选择确定或取消。

3. 用户输入了用户名和口令后，客户端软件会在原先的请求上增加认证消息头，然后重新发送再次尝试。

<span id="2.2"></span>

### 对应报文

* 首次发送

``` http
GET /private/index.html HTTP/1.0
Host: localhost
```

* 首次响应

``` http
HTTP/1.0 401 Authorization Required
Server: HTTPd/1.0
Date: Sat, 27 Nov 2004 10:18:15 GMT
WWW-Authenticate: Basic realm="Secure Area"
Content-Type: text/html
Content-Length: 311
```

* 输入用户名密码后

``` http
GET /private/index.html HTTP/1.0
Host: localhost
Authorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==
```

* 认证成功应答

``` http
HTTP/1.0 200 OK
Server: HTTPd/1.0
Date: Sat, 27 Nov 2004 10:19:07 GMT
Content-Type: text/html
Content-Length: 10476
```

<span id="3"></span>

## Digest Auth 摘要认证

前文说到了很多基于BA认证所存在的问题，因此在后续计算机的发展中，推出了升级版的BA认证，也就是DA认证，中文名是摘要认证。它之于BA认证的最重要的升级点就在于，DA认证
是采用密文传输的方式进行的。

<span id="3.1"></span>

### 摘要盘问

不同于BA的检测401直接返回认证，摘要认证是一种“盘问式”的认证流程，服务器想要查证用户的身份，它产生一个摘要盘问（digest challenge），并发送给用户。典型的摘要盘问如下：



<span id="4"></span>

## Session认证

Session认证并不是一个认证协议，Session是针对已认证用户的额外补充手段，例如前文提到的BA认证，目前来说，认证的内容就会以session存储在本地。

Session究竟是什么？Session是保存在服务器端的经过加密的存储特定用户会话所需的属性及配置信息的数据。当我们打开浏览器访问某网站时，Session建立，只要浏览器不关闭(也有时间限制，可以自己设置超时时间)，这个网站就可以记录用户的状态，当浏览器关闭时，Session结束。

浏览器第一次发送请求时，服务器自动生成了Session(用户会话所需的属性及配置信息)，并且生成了Session ID来唯一标识这个Session，并将其通过响应发送到浏览器。浏览器第二次发送请求会将前一次服务器响应中的Session ID放在请求的Cookie中一并发送到服务器上，服务器从请求中提取出Session ID，并和保存的所有Session ID进行对比，找到这个用户所对应的Session，从而知道了用户的登录信息。一般Session ID会有时间限制，超时后毁掉这个值，默认30分钟。

也就是说，服务器和客户端都会对session进行保存。如果我们将服务器进行清理重启后，session就会失效，我们需要重新对其进行登录认证。

当用户在应用程序的 Web页间跳转时，也就是一次会话期间，浏览器不关闭时，Session ID是一直不变的，同时连续访问的页面并不会因为到了30分钟而失效，服务器会刷新seion的有效时间。

举一个形象的例子，这次阿里巴巴依旧来到了大门前，只是这一次认证身份的是一个门卫大爷，门卫大爷很健忘，只能记住30分钟的东西，当阿里巴巴第一次进门后，门卫大爷记住了你是可以访问的人，但是如果你30分钟没有再次在门卫面前出现之时，再进门就必须再次喊出口号。

Session认证的一个非常大的不足就是服务器也需要对Session请求进行存储处理，如果用户量非常大，那么对于服务器而言，处理认证的系统压力是非常非常大的，而且由于http协议是无状态的，也就是说我们并不是时时刻刻都需要存储客户端的状态，那么这个流程就可以进行更好的改进

<span id="2.4"></span>

## Cookie认证


## OAuth 1/2

<span id="2.4"></span>

## OpenId

<span id="2.5"></span>

## Token & JWT

<span id="3"></span>

## Reference

> [Wiki——Http基础认证](https://zh.wikipedia.org/wiki/HTTP%E5%9F%BA%E6%9C%AC%E8%AE%A4%E8%AF%81)
>
> [HTTP认证之摘要认证——Digest](https://www.cnblogs.com/xiaoxiaotank/p/11078571.html)

## About Me

<p id="PSignature" style="padding-top: 10px; padding-right: 10px; padding-bottom: 10px; padding-left: 60px; background: url(&quot;https://www.cnblogs.com/images/cnblogs_com/ECJTUACM-873284962/1318325/o_o_122329534672560.png&quot;) #e5f1f4 no-repeat 1% 50%; font-family: 微软雅黑; font-size: 12px; border: #e0e0e0 1px dashed"> <br>
        作　　者：<strong><span style="font-size: 12px; color: red"><a href="https://www.cnblogs.com/WarrenRyan/" target="_blank">WarrenRyan</a></span></strong>
        <br>
        出　　处：<a href="https://www.cnblogs.com/WarrenRyan/" target="_blank">https://www.cnblogs.com/WarrenRyan/</a>
        <br>
        本文对应视频：<a href="" target="_blank">BiliBili(待重录)</a>
        <br>
        关于作者：热爱数学、热爱机器学习，喜欢弹钢琴的不知名小菜鸡。
        <br>
        版权声明：本文版权归作者所有，欢迎转载，但未经作者同意必须保留此段声明，且在文章页面明显位置给出原文链接。若需商用，则必须联系作者获得授权。
        <br>
        特此声明：所有评论和私信都会在第一时间回复。也欢迎园子的大大们指正错误，共同进步。或者<a href="http://msg.cnblogs.com/msg/send/WarrenRyan">直接私信</a>我
        <br>
        声援博主：如果您觉得文章对您有帮助，可以点击文章右下角<strong><span style="color: #ff0000; font-size: 18pt">【<a id="post-up">推荐</a>】</span></strong>一下。您的鼓励是作者坚持原创和持续写作的最大动力！
        <br>
        <br>
        <br>
        博主一些其他平台：
        <br>
        <strong><a>微信公众号：寤言不寐</a></strong>
        <br>
        <strong><a href="https://space.bilibili.com/33311288" target="_blank">BiBili——小陈的学习记录</a></strong>
        <br>
        <strong><a href="https://github.com/StevenEco" target="_blank">Github——StevenEco</a></strong>
        <br>
        <strong><a href="https://space.bilibili.com/667199655" target="_blank">BiBili——记录学习的小陈（计算机考研纪实）</a></strong>
        <br>
        <strong><a href="https://juejin.cn/user/3756401007016173" target="_blank">掘金——小陈的学习记录</a></strong>
        <br>
        <strong><a href="https://space.bilibili.com/33311288" target="_blank">知乎——小陈的学习记录</a></strong>
        <br>
    </p>
    
<br/>
<div>
<div class="github-card" data-github="StevenEco" data-width="350" data-height="150" data-theme="default"></div>
<div class="github-card" data-github="StevenEco/.NetCoreGuide" data-width="350" data-height="150" data-theme="default"></div>
</div>

### 联系方式

<a style="font-family: 微软雅黑; font-size: 18px;" href="mailto:cxtionch@gmail.com">电子邮件：cxtionch@live.com</a>
<br/>
<br/>
<p style="font-family: 微软雅黑; font-size: 18px;">社交媒体联系二维码：</p>
<img style=" width: 100%" src="https://images.cnblogs.com/cnblogs_com/WarrenRyan/2090249/o_220106070541_%E4%B8%AA%E4%BA%BA%E4%BF%A1%E6%81%AF%E6%A0%8F.jpg"/>
